'use strict';

var Client = require('./index')
  , argv = process.argv
  , ltx  = require('ltx')

var facebookId = '740035183'
var appId = '128726213879235'
var appSecret = 'ec661a868376b0ec79ee819ec5cd55d7'

var client = new Client({ 
    jid: '-' + facebookId + '@chat.facebook.com', 
    api_key: appId,
    secret_key: appSecret,
    access_token: '',
    preferredSaslMechanism: 'X-FACEBOOK-PLATFORM'
})

client.addListener('online', function(data) {
    console.log('Connected as ' + data.jid.user + '@' + data.jid.domain + '/' + data.jid.resource)
    argv.slice(5).forEach(function(to) {
        var stanza = new ltx.Element(
            'message',
            { to: to, type: 'chat' }
        ).c('body').t(argv[4])
        client.send(stanza)
    })

    // nodejs has nothing left to do and will exit
    client.end()
})

client.addListener('error', function(e) {
    console.error(e)
    process.exit(1)
})
